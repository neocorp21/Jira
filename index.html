<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Validación de Cookie en GitHub Pages</title>
</head>
<body>

    <h1>Validación de Cookie de Jira (GitHub/Web)</h1>

    <p>Ingresa la cookie de sesión completa (Ej: `JSESSIONID=...`):</p>
    <input type="text" id="cookieInput" style="width: 80%; padding: 8px;">

    <button onclick="validarCookieWeb()" id="submitBtn">Validar Cookie (GET)</button>

    <pre id="resultado" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap;">Esperando consulta...</pre>

    <script>
        // La URL de Jira
        const JIRA_API_URL = 'https://jira.globaldevtools.bbva.com/rest/api/2/myself';
        
        // ⚠️ ADVERTENCIA: Usar un proxy público como este (cors-anywhere) no es seguro ni confiable para producción.
        // Es solo para demostrar la funcionalidad. En producción necesitarías tu propio backend/proxy.
        const PROXY_URL = 'https://cors-anywhere.herokuapp.com/'; 
        
        function validarCookieWeb() {
            const cookieInput = document.getElementById('cookieInput');
            const resultadoPre = document.getElementById('resultado');
            const submitBtn = document.getElementById('submitBtn');
            const cookieValue = cookieInput.value.trim();

            if (!cookieValue) {
                resultadoPre.textContent = 'Error: Por favor, ingresa la cookie.';
                return;
            }

            submitBtn.disabled = true;
            resultadoPre.textContent = 'Cargando...';

            // Usamos el proxy para evitar el error CORS en el navegador
            const finalUrl = PROXY_URL + JIRA_API_URL;

            // Opción de configuración para la solicitud
            const options = {
                method: 'GET',
                headers: {
                    // La cookie DEBE ser enviada en el header 'Cookie'
                    'Cookie': cookieValue,
                    'Accept': 'application/json'
                    // NOTA: Algunos proxies requieren que el header 'X-Requested-With' se omita o se establezca
                }
            };

            fetch(finalUrl, options)
                .then(response => {
                    // Si el proxy devuelve un error, el código de estado HTTP puede ser 200, pero el cuerpo indica el error
                    if (response.status === 401 || response.status === 403) {
                         return response.text().then(text => { throw new Error(`Autenticación fallida (${response.status}). Cookie expirada/inválida.`); });
                    }
                    if (!response.ok) {
                         return response.text().then(text => { throw new Error(`Error HTTP: ${response.status}. ${text.substring(0, 100)}...`); });
                    }
                    return response.json();
                })
                .then(data => {
                    // Éxito
                    resultadoPre.textContent = '✅ Éxito:\n' + JSON.stringify(data, null, 2);
                    console.log('Datos recibidos:', data);
                })
                .catch(error => {
                    // Fallo de red, CORS, o respuesta no-200
                    resultadoPre.textContent = '❌ Error:\n' + error.message;
                    console.error('Fallo en la solicitud:', error);
                })
                .finally(() => {
                    submitBtn.disabled = false;
                });
        }
    </script>

</body>
</html>
